# Microservice Cache / Kafka Template

## Microservice Structure

![Package Structure](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/MS-Pkg-Structure.jpg)

### What the Template Provides out of the box

1. Springboot App with Swagger Docs (...adapters.controllers)
2. Exception Handling with Exception Framework using AOP ( ..adapters.aop)
3. Log Management using Logback  (...adapters.filters)
4. Standardized REST Responses (...domain.models.StandardResponse) 
5. Security using JWT Tokens (...adapters.security)
6. Encrypting Sensitie Data using Encryption Algorithms (...security)
7. JPA configurations for H2 and PostgreSQL (...server.config)

### Pre-Requisites 

1. Java 17 (17.0.3.1)
2. Maven 3.8.6
3. Git 2.31

### Microservice Cache / Kafka Template gives you a 

1. SpringBoot App template with 
2. Open API 3 Ex, 
3. Spring Actuator, 
4. Spring Sleuth and 
5. Redis Cache Implementation with 
6. H2 In Memory Database
7. POM File with (SpringBoot) Fat and Thin (Maven) jar file creation and 
8. Dockerfile for containerisation.

## 1. Setting up the Template

### Step 1.1 - Getting Started

1. git clone https://github.com/MetaArivu/ms-cache-kafka-quickstart.git
2. cd ms-cache-kafka-quickstart

###  Step 1.2 - Compile (Once your code is ready) 

1. run the compile from ms-cache-kafka-quickstart
2. compile OR ./compile

The above compile script will do the following

1. Clean up the target folder
2. Generate the build no. and build date (takes application.properties backup)
3. build final output SpringBoot fat jar and maven thin jar
4. copy the jar files (and dependencies) to src/docker folder
5. copy the application.properties file to current folder and src/docker folder

In Step 2.2 application.properties file will be auto generated by the "compile" script. This is a critical step.
Without generated application.properties file the service will NOT be running.

###  Step 1.3 - Run

1. run OR ./run
2. test OR ./test

#### $ run Result 
![Run Results](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/MS-Run-Result.jpg)

#### MS Cache Swagger UI Docs for Testing
![Swagger Docs](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/MS-Cache-Swagger-UI.jpg)

### Step 1.4 - Testing the APIs Using Swagger API Docs or Postman

To test the APIs (in secure mode - you will see a lock icon in the Swagger Docs)

#### Step 1.4.1: Copy the Auth Token
![Authorize Request](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/ms-cache-with-Test-Tokens.jpg)

#### Step 1.4.2: Click on the Authorize Button (Top Left the Swagger UI)

![Authorize Request](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/ms-cache-with-Test-Tokens-2.jpg)

#### Step 1.4.3: Enter the Token and Click Authorize

![Authorize Request](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/ms-cache-with-Test-Tokens-3.jpg)

### Step 1.5 -  Import Swagger API Docs Into Postman

#### Step 1.5.1: Swagger Open API 3.0 Docs JSON Format
![Swagger JSON](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/Import-API-into-Postman-0.jpg)

#### Step 1.5.2: Import Into Postman - Set the Link
![Postman Import](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/Import-API-Into-Postman-1.jpg)

#### Step 1.5.3: Import Into Postman - Confirm
![Postman Import](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/Import-API-into-Postman-2.jpg)

## 2. CRUD Operations Demo & Error Handling

### 2.1 GET Query Execution and Fallback Data
![Crud Get](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/crud/crud-1-get-fallback.jpg)

### 2.2 POST Create Data - Product 1
![Crud Post-1](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/crud/crud-2-post-prod-1-A.jpg)

### 2.3 POST Create Data - Product 1 : Result
![Crud Post-2](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/crud/crud-2-post-prod-1-B.jpg)

### 2.4 POST Create Data - Product 2 
![Crud Post-3](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/crud/crud-3-post-prod-2.jpg)

### 2.5 POST Create Data - Product 3
![Crud Post-4](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/crud/crud-4-post-prod-3.jpg)

### 2.6 GET All the Data (Created in Steps 2.2 - 2.5)
![Crud Get-5](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/crud/crud-5-get-from-db.jpg)


## 3. Configure the Template: Setup Org, Service, & Container Name, Versions, API Path in app.props.tmpl

1. git clone https://github.com/MetaArivu/ms-cache-kafka-quickstart.git
2. cd ms-cache-kafka-quickstart

Update the Properties Template

1. Update the Org Name in src/main/resources/app.props.tmpl file (service.org)
2. Update the Microservice name in src/main/resources/app.props.tmpl file (service.name)
3. Update the API Version in src/main/resources/app.props.tmpl file (service.api.version)
4. Update the API Name in src/main/resources/app.props.tmpl file (service.api.name)
5. Update the Container Name in src/main/resources/app.props.tmpl file (service.container)
6. Update the Server Version src/main/resources/app.props.tmpl file (server.version)
   Pom File
   <version>0.3.0</version>
   app.props.tmpl
   =======================================================================
   Microservice Server Properties
   =======================================================================
   server.version=0.3.0

Sample Property File Template
![Property File](https://raw.githubusercontent.com/MetaArivu/ms-cache-kafka-quickstart/master/diagrams/MS-Property-File.jpg)

When you change the version in POM.xml, update that info in src/main/resources/app.props.tmpl - server.version property also.


## 4. Docker Container Setup

### Step 4.1 - Verify Container Name and Org Name

1. Verify the Org Name in src/main/resources/app.props.tmpl file (service.org)
2. Verify the container name in src/main/resources/app.props.tmpl file (service.container)
3. Verify the microservice name in src/main/resources/app.props.tmpl file (service.api.name)

### Step 4.2 - Build the image

1. build (Build the Container)
2. scan (Scan the container vulnerabilities)

### Step 4.3 - Test the image

1. start (Start the Container)
2. logs (to view the container logs) - Wait for the Container to Startup
3. Check the URL in a Browser

### Step 4.4 - Push the image to Container Cloud Repository

Update the Org Name in src/main/resources/app.props.tmpl file (service.org)
Setup the Docker Hub or any other Container Registry

1. push (Push the Container to Docker Hub)

### Step 4.5 Other Commands

1. stop (Stop the Container)
2. stats (show container stats)


(C) Copyright 2022 - MetaArivu: Apache 2 License
Author: Araf Karsh Hamid
